/*!--------------------------------------------------------
 * Copyright (C) Microsoft Corporation. All rights reserved.
 *--------------------------------------------------------*/var q=function(e,t){return q=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,n){r.__proto__=n}||function(r,n){for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&(r[s]=n[s])},q(e,t)};export function __extends(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");q(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}export var __assign=function(){return __assign=Object.assign||function(t){for(var r,n=1,s=arguments.length;n<s;n++){r=arguments[n];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(t[i]=r[i])}return t},__assign.apply(this,arguments)};export function __rest(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,n=Object.getOwnPropertySymbols(e);s<n.length;s++)t.indexOf(n[s])<0&&Object.prototype.propertyIsEnumerable.call(e,n[s])&&(r[n[s]]=e[n[s]]);return r}export function __decorate(e,t,r,n){var s=arguments.length,i=s<3?t:n===null?n=Object.getOwnPropertyDescriptor(t,r):n,h;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")i=Reflect.decorate(e,t,r,n);else for(var d=e.length-1;d>=0;d--)(h=e[d])&&(i=(s<3?h(i):s>3?h(t,r,i):h(t,r))||i);return s>3&&i&&Object.defineProperty(t,r,i),i}export function __param(e,t){return function(r,n){t(r,n,e)}}export function __esDecorate(e,t,r,n,s,i){function h(S){if(S!==void 0&&typeof S!="function")throw new TypeError("Function expected");return S}for(var d=n.kind,y=d==="getter"?"get":d==="setter"?"set":"value",f=!t&&e?n.static?e:e.prototype:null,_=t||(f?Object.getOwnPropertyDescriptor(f,n.name):{}),w,j=!1,p=r.length-1;p>=0;p--){var g={};for(var v in n)g[v]=v==="access"?{}:n[v];for(var v in n.access)g.access[v]=n.access[v];g.addInitializer=function(S){if(j)throw new TypeError("Cannot add initializers after decoration has completed");i.push(h(S||null))};var m=(0,r[p])(d==="accessor"?{get:_.get,set:_.set}:_[y],g);if(d==="accessor"){if(m===void 0)continue;if(m===null||typeof m!="object")throw new TypeError("Object expected");(w=h(m.get))&&(_.get=w),(w=h(m.set))&&(_.set=w),(w=h(m.init))&&s.unshift(w)}else(w=h(m))&&(d==="field"?s.unshift(w):_[y]=w)}f&&Object.defineProperty(f,n.name,_),j=!0}export function __runInitializers(e,t,r){for(var n=arguments.length>2,s=0;s<t.length;s++)r=n?t[s].call(e,r):t[s].call(e);return n?r:void 0}export function __propKey(e){return typeof e=="symbol"?e:"".concat(e)}export function __setFunctionName(e,t,r){return typeof t=="symbol"&&(t=t.description?"[".concat(t.description,"]"):""),Object.defineProperty(e,"name",{configurable:!0,value:r?"".concat(r," ",t):t})}export function __metadata(e,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(e,t)}export function __awaiter(e,t,r,n){function s(i){return i instanceof r?i:new r(function(h){h(i)})}return new(r||(r=Promise))(function(i,h){function d(_){try{f(n.next(_))}catch(w){h(w)}}function y(_){try{f(n.throw(_))}catch(w){h(w)}}function f(_){_.done?i(_.value):s(_.value).then(d,y)}f((n=n.apply(e,t||[])).next())})}export function __generator(e,t){var r={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},n,s,i,h;return h={next:d(0),throw:d(1),return:d(2)},typeof Symbol=="function"&&(h[Symbol.iterator]=function(){return this}),h;function d(f){return function(_){return y([f,_])}}function y(f){if(n)throw new TypeError("Generator is already executing.");for(;h&&(h=0,f[0]&&(r=0)),r;)try{if(n=1,s&&(i=f[0]&2?s.return:f[0]?s.throw||((i=s.return)&&i.call(s),0):s.next)&&!(i=i.call(s,f[1])).done)return i;switch(s=0,i&&(f=[f[0]&2,i.value]),f[0]){case 0:case 1:i=f;break;case 4:return r.label++,{value:f[1],done:!1};case 5:r.label++,s=f[1],f=[0];continue;case 7:f=r.ops.pop(),r.trys.pop();continue;default:if(i=r.trys,!(i=i.length>0&&i[i.length-1])&&(f[0]===6||f[0]===2)){r=0;continue}if(f[0]===3&&(!i||f[1]>i[0]&&f[1]<i[3])){r.label=f[1];break}if(f[0]===6&&r.label<i[1]){r.label=i[1],i=f;break}if(i&&r.label<i[2]){r.label=i[2],r.ops.push(f);break}i[2]&&r.ops.pop(),r.trys.pop();continue}f=t.call(e,r)}catch(_){f=[6,_],s=0}finally{n=i=0}if(f[0]&5)throw f[1];return{value:f[0]?f[1]:void 0,done:!0}}}export var __createBinding=Object.create?function(e,t,r,n){n===void 0&&(n=r);var s=Object.getOwnPropertyDescriptor(t,r);(!s||("get"in s?!t.__esModule:s.writable||s.configurable))&&(s={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,s)}:function(e,t,r,n){n===void 0&&(n=r),e[n]=t[r]};export function __exportStar(e,t){for(var r in e)r!=="default"&&!Object.prototype.hasOwnProperty.call(t,r)&&__createBinding(t,e,r)}export function __values(e){var t=typeof Symbol=="function"&&Symbol.iterator,r=t&&e[t],n=0;if(r)return r.call(e);if(e&&typeof e.length=="number")return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}export function __read(e,t){var r=typeof Symbol=="function"&&e[Symbol.iterator];if(!r)return e;var n=r.call(e),s,i=[],h;try{for(;(t===void 0||t-- >0)&&!(s=n.next()).done;)i.push(s.value)}catch(d){h={error:d}}finally{try{s&&!s.done&&(r=n.return)&&r.call(n)}finally{if(h)throw h.error}}return i}export function __spread(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(__read(arguments[t]));return e}export function __spreadArrays(){for(var e=0,t=0,r=arguments.length;t<r;t++)e+=arguments[t].length;for(var n=Array(e),s=0,t=0;t<r;t++)for(var i=arguments[t],h=0,d=i.length;h<d;h++,s++)n[s]=i[h];return n}export function __spreadArray(e,t,r){if(r||arguments.length===2)for(var n=0,s=t.length,i;n<s;n++)(i||!(n in t))&&(i||(i=Array.prototype.slice.call(t,0,n)),i[n]=t[n]);return e.concat(i||Array.prototype.slice.call(t))}export function __await(e){return this instanceof __await?(this.v=e,this):new __await(e)}export function __asyncGenerator(e,t,r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n=r.apply(e,t||[]),s,i=[];return s={},d("next"),d("throw"),d("return",h),s[Symbol.asyncIterator]=function(){return this},s;function h(p){return function(g){return Promise.resolve(g).then(p,w)}}function d(p,g){n[p]&&(s[p]=function(v){return new Promise(function(m,S){i.push([p,v,m,S])>1||y(p,v)})},g&&(s[p]=g(s[p])))}function y(p,g){try{f(n[p](g))}catch(v){j(i[0][3],v)}}function f(p){p.value instanceof __await?Promise.resolve(p.value.v).then(_,w):j(i[0][2],p)}function _(p){y("next",p)}function w(p){y("throw",p)}function j(p,g){p(g),i.shift(),i.length&&y(i[0][0],i[0][1])}}export function __asyncDelegator(e){var t,r;return t={},n("next"),n("throw",function(s){throw s}),n("return"),t[Symbol.iterator]=function(){return this},t;function n(s,i){t[s]=e[s]?function(h){return(r=!r)?{value:__await(e[s](h)),done:!1}:i?i(h):h}:i}}export function __asyncValues(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t=e[Symbol.asyncIterator],r;return t?t.call(e):(e=typeof __values=="function"?__values(e):e[Symbol.iterator](),r={},n("next"),n("throw"),n("return"),r[Symbol.asyncIterator]=function(){return this},r);function n(i){r[i]=e[i]&&function(h){return new Promise(function(d,y){h=e[i](h),s(d,y,h.done,h.value)})}}function s(i,h,d,y){Promise.resolve(y).then(function(f){i({value:f,done:d})},h)}}export function __makeTemplateObject(e,t){return Object.defineProperty?Object.defineProperty(e,"raw",{value:t}):e.raw=t,e}var T=Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t};export function __importStar(e){if(e&&e.__esModule)return e;var t={};if(e!=null)for(var r in e)r!=="default"&&Object.prototype.hasOwnProperty.call(e,r)&&__createBinding(t,e,r);return T(t,e),t}export function __importDefault(e){return e&&e.__esModule?e:{default:e}}export function __classPrivateFieldGet(e,t,r,n){if(r==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof t=="function"?e!==t||!n:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return r==="m"?n:r==="a"?n.call(e):n?n.value:t.get(e)}export function __classPrivateFieldSet(e,t,r,n,s){if(n==="m")throw new TypeError("Private method is not writable");if(n==="a"&&!s)throw new TypeError("Private accessor was defined without a setter");if(typeof t=="function"?e!==t||!s:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return n==="a"?s.call(e,r):s?s.value=r:t.set(e,r),r}export function __classPrivateFieldIn(e,t){if(t===null||typeof t!="object"&&typeof t!="function")throw new TypeError("Cannot use 'in' operator on non-object");return typeof e=="function"?t===e:e.has(t)}export function __addDisposableResource(e,t,r){if(t!=null){if(typeof t!="object"&&typeof t!="function")throw new TypeError("Object expected.");var n,s;if(r){if(!Symbol.asyncDispose)throw new TypeError("Symbol.asyncDispose is not defined.");n=t[Symbol.asyncDispose]}if(n===void 0){if(!Symbol.dispose)throw new TypeError("Symbol.dispose is not defined.");n=t[Symbol.dispose],r&&(s=n)}if(typeof n!="function")throw new TypeError("Object not disposable.");s&&(n=function(){try{s.call(this)}catch(i){return Promise.reject(i)}}),e.stack.push({value:t,dispose:n,async:r})}else r&&e.stack.push({async:!0});return t}var I=typeof SuppressedError=="function"?SuppressedError:function(e,t,r){var n=new Error(r);return n.name="SuppressedError",n.error=e,n.suppressed=t,n};export function __disposeResources(e){function t(n){e.error=e.hasError?new I(n,e.error,"An error was suppressed during disposal."):n,e.hasError=!0}function r(){for(;e.stack.length;){var n=e.stack.pop();try{var s=n.dispose&&n.dispose.call(n.value);if(n.async)return Promise.resolve(s).then(r,function(i){return t(i),r()})}catch(i){t(i)}}if(e.hasError)throw e.error}return r()}export default{__extends,__assign,__rest,__decorate,__param,__metadata,__awaiter,__generator,__createBinding,__exportStar,__values,__read,__spread,__spreadArrays,__spreadArray,__await,__asyncGenerator,__asyncDelegator,__asyncValues,__makeTemplateObject,__importStar,__importDefault,__classPrivateFieldGet,__classPrivateFieldSet,__classPrivateFieldIn,__addDisposableResource,__disposeResources};define(["require","exports","../errors.js","../event.js","../lifecycle.js","../network.js","../platform.js","../strings.js"],function(e,t,r,n,s,i,h,d){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SimpleWorkerServer=t.SimpleWorkerClient=void 0,t.logOnceWebWorkerWarning=w,t.create=R;const y="default",f="$initialize";let _=!1;function w(b){h.isWeb&&(_||(_=!0,console.warn("Could not create web worker(s). Falling back to loading web worker code in main thread, which might cause UI freezes. Please see https://github.com/microsoft/monaco-editor#faq")),console.warn(b.message))}class j{constructor(o,a,u,l,c){this.vsWorker=o,this.req=a,this.channel=u,this.method=l,this.args=c,this.type=0}}class p{constructor(o,a,u,l){this.vsWorker=o,this.seq=a,this.res=u,this.err=l,this.type=1}}class g{constructor(o,a,u,l,c){this.vsWorker=o,this.req=a,this.channel=u,this.eventName=l,this.arg=c,this.type=2}}class v{constructor(o,a,u){this.vsWorker=o,this.req=a,this.event=u,this.type=3}}class m{constructor(o,a){this.vsWorker=o,this.req=a,this.type=4}}class S{constructor(o){this._workerId=-1,this._handler=o,this._lastSentReq=0,this._pendingReplies=Object.create(null),this._pendingEmitters=new Map,this._pendingEvents=new Map}setWorkerId(o){this._workerId=o}sendMessage(o,a,u){const l=String(++this._lastSentReq);return new Promise((c,E)=>{this._pendingReplies[l]={resolve:c,reject:E},this._send(new j(this._workerId,l,o,a,u))})}listen(o,a,u){let l=null;const c=new n.Emitter({onWillAddFirstListener:()=>{l=String(++this._lastSentReq),this._pendingEmitters.set(l,c),this._send(new g(this._workerId,l,o,a,u))},onDidRemoveLastListener:()=>{this._pendingEmitters.delete(l),this._send(new m(this._workerId,l)),l=null}});return c.event}handleMessage(o){!o||!o.vsWorker||this._workerId!==-1&&o.vsWorker!==this._workerId||this._handleMessage(o)}createProxyToRemoteChannel(o,a){const u={get:(l,c)=>(typeof c=="string"&&!l[c]&&(M(c)?l[c]=E=>this.listen(o,c,E):P(c)?l[c]=this.listen(o,c,void 0):c.charCodeAt(0)===36&&(l[c]=async(...E)=>(await a?.(),this.sendMessage(o,c,E)))),l[c])};return new Proxy(Object.create(null),u)}_handleMessage(o){switch(o.type){case 1:return this._handleReplyMessage(o);case 0:return this._handleRequestMessage(o);case 2:return this._handleSubscribeEventMessage(o);case 3:return this._handleEventMessage(o);case 4:return this._handleUnsubscribeEventMessage(o)}}_handleReplyMessage(o){if(!this._pendingReplies[o.seq]){console.warn("Got reply to unknown seq");return}const a=this._pendingReplies[o.seq];if(delete this._pendingReplies[o.seq],o.err){let u=o.err;o.err.$isError&&(u=new Error,u.name=o.err.name,u.message=o.err.message,u.stack=o.err.stack),a.reject(u);return}a.resolve(o.res)}_handleRequestMessage(o){const a=o.req;this._handler.handleMessage(o.channel,o.method,o.args).then(l=>{this._send(new p(this._workerId,a,l,void 0))},l=>{l.detail instanceof Error&&(l.detail=(0,r.transformErrorForSerialization)(l.detail)),this._send(new p(this._workerId,a,void 0,(0,r.transformErrorForSerialization)(l)))})}_handleSubscribeEventMessage(o){const a=o.req,u=this._handler.handleEvent(o.channel,o.eventName,o.arg)(l=>{this._send(new v(this._workerId,a,l))});this._pendingEvents.set(a,u)}_handleEventMessage(o){if(!this._pendingEmitters.has(o.req)){console.warn("Got event for unknown req");return}this._pendingEmitters.get(o.req).fire(o.event)}_handleUnsubscribeEventMessage(o){if(!this._pendingEvents.has(o.req)){console.warn("Got unsubscribe for unknown req");return}this._pendingEvents.get(o.req).dispose(),this._pendingEvents.delete(o.req)}_send(o){const a=[];if(o.type===0)for(let u=0;u<o.args.length;u++)o.args[u]instanceof ArrayBuffer&&a.push(o.args[u]);else o.type===1&&o.res instanceof ArrayBuffer&&a.push(o.res);this._handler.sendMessage(o,a)}}class k extends s.Disposable{constructor(o,a){super(),this._localChannels=new Map,this._worker=this._register(o.create({moduleId:"vs/base/common/worker/simpleWorker",esmModuleLocation:a.esmModuleLocation,label:a.label},c=>{this._protocol.handleMessage(c)},c=>{(0,r.onUnexpectedError)(c)})),this._protocol=new S({sendMessage:(c,E)=>{this._worker.postMessage(c,E)},handleMessage:(c,E,O)=>this._handleMessage(c,E,O),handleEvent:(c,E,O)=>this._handleEvent(c,E,O)}),this._protocol.setWorkerId(this._worker.getId());let u=null;const l=globalThis.require;typeof l<"u"&&typeof l.getConfig=="function"?u=l.getConfig():typeof globalThis.requirejs<"u"&&(u=globalThis.requirejs.s.contexts._.config),this._onModuleLoaded=this._protocol.sendMessage(y,f,[this._worker.getId(),JSON.parse(JSON.stringify(u)),a.moduleId]),this.proxy=this._protocol.createProxyToRemoteChannel(y,async()=>{await this._onModuleLoaded}),this._onModuleLoaded.catch(c=>{this._onError("Worker failed to load "+a.moduleId,c)})}_handleMessage(o,a,u){const l=this._localChannels.get(o);if(!l)return Promise.reject(new Error(`Missing channel ${o} on main thread`));if(typeof l[a]!="function")return Promise.reject(new Error(`Missing method ${a} on main thread channel ${o}`));try{return Promise.resolve(l[a].apply(l,u))}catch(c){return Promise.reject(c)}}_handleEvent(o,a,u){const l=this._localChannels.get(o);if(!l)throw new Error(`Missing channel ${o} on main thread`);if(M(a)){const c=l[a].call(l,u);if(typeof c!="function")throw new Error(`Missing dynamic event ${a} on main thread channel ${o}.`);return c}if(P(a)){const c=l[a];if(typeof c!="function")throw new Error(`Missing event ${a} on main thread channel ${o}.`);return c}throw new Error(`Malformed event name ${a}`)}setChannel(o,a){this._localChannels.set(o,a)}_onError(o,a){console.error(o),console.info(a)}}t.SimpleWorkerClient=k;function P(b){return b[0]==="o"&&b[1]==="n"&&d.isUpperAsciiLetter(b.charCodeAt(2))}function M(b){return/^onDynamic/.test(b)&&d.isUpperAsciiLetter(b.charCodeAt(9))}class x{constructor(o,a){this._localChannels=new Map,this._remoteChannels=new Map,this._requestHandlerFactory=a,this._requestHandler=null,this._protocol=new S({sendMessage:(u,l)=>{o(u,l)},handleMessage:(u,l,c)=>this._handleMessage(u,l,c),handleEvent:(u,l,c)=>this._handleEvent(u,l,c)})}onmessage(o){this._protocol.handleMessage(o)}_handleMessage(o,a,u){if(o===y&&a===f)return this.initialize(u[0],u[1],u[2]);const l=o===y?this._requestHandler:this._localChannels.get(o);if(!l)return Promise.reject(new Error(`Missing channel ${o} on worker thread`));if(typeof l[a]!="function")return Promise.reject(new Error(`Missing method ${a} on worker thread channel ${o}`));try{return Promise.resolve(l[a].apply(l,u))}catch(c){return Promise.reject(c)}}_handleEvent(o,a,u){const l=o===y?this._requestHandler:this._localChannels.get(o);if(!l)throw new Error(`Missing channel ${o} on worker thread`);if(M(a)){const c=l[a].call(l,u);if(typeof c!="function")throw new Error(`Missing dynamic event ${a} on request handler.`);return c}if(P(a)){const c=l[a];if(typeof c!="function")throw new Error(`Missing event ${a} on request handler.`);return c}throw new Error(`Malformed event name ${a}`)}getChannel(o){if(!this._remoteChannels.has(o)){const a=this._protocol.createProxyToRemoteChannel(o);this._remoteChannels.set(o,a)}return this._remoteChannels.get(o)}async initialize(o,a,u){if(this._protocol.setWorkerId(o),this._requestHandlerFactory){this._requestHandler=this._requestHandlerFactory(this);return}a&&(typeof a.baseUrl<"u"&&delete a.baseUrl,typeof a.paths<"u"&&typeof a.paths.vs<"u"&&delete a.paths.vs,typeof a.trustedTypesPolicy<"u"&&delete a.trustedTypesPolicy,a.catchError=!0,globalThis.require.config(a));const l=i.FileAccess.asBrowserUri(`${u}.js`).toString(!0);return new Promise((c,E)=>{e([`${l}`],c,E)}).then(c=>{if(this._requestHandler=c.create(this),!this._requestHandler)throw new Error("No RequestHandler!")})}}t.SimpleWorkerServer=x;function R(b){return new x(b,null)}});

//# sourceMappingURL=../../../../min-maps/vs/base/worker/workerMain.js.map